
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Installing &#8212; t3kton 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="From Prebuilt Packages" href="packaged.html" />
    <link rel="prev" title="Give it a Try" href="index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="installing">
<h1>Installing<a class="headerlink" href="#installing" title="Permalink to this headline">¶</a></h1>
<p>Create an Ubuntu Xenial(16.04LTS) VM, name it <cite>contractor</cite>, set the fqdn to <cite>contractor.site1.test</cite>
Ideally it should be in a /24 network.  Offset 1 is assumed to be the gateway.
All these values can be adjusted either in the setupWizard file before it is run,
or after it is setup, you can use the API to edit these values.
The DNS server will be set for the contractor VM, and bind on the contractor vm will
be set to forward to the DNS server that was originally configured on the VM.</p>
<div class="section" id="from-source">
<h2>From Source<a class="headerlink" href="#from-source" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="source.html"><span class="doc">From Source</span></a></p>
</div>
<div class="section" id="from-packages">
<h2>From Packages<a class="headerlink" href="#from-packages" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="packaged.html"><span class="doc">From Prebuilt Packages</span></a></p>
</div>
</div>
<div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="set-up-infrastructure">
<h2>Set up Infrastructure<a class="headerlink" href="#set-up-infrastructure" title="Permalink to this headline">¶</a></h2>
<p>To prevent your new contractor VM from taking over the network you are curently
connected to, you will need to configure a issloated network.  There are also
some other Infrastructure related tasks that need to be done.</p>
<p><a class="reference internal" href="setup_vcenter.html"><span class="doc">VCenter/ESX Setup</span></a></p>
<p><a class="reference internal" href="setup_virtualbox.html"><span class="doc">VirtualBox Setup</span></a></p>
<p><a class="reference internal" href="setup_ipmi.html"><span class="doc">IPMI Setup</span></a></p>
<p><a class="reference internal" href="setup_amt.html"><span class="doc">AMT Setup</span></a></p>
</div>
<div class="section" id="create-database">
<h2>Create Database<a class="headerlink" href="#create-database" title="Permalink to this headline">¶</a></h2>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; height: auto;">
    <iframe src="https://www.youtube.com/embed/Wjm6kKus1Ho" frameborder="0" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe>
</div><p>Install Postgres:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">postgresql</span><span class="o">-</span><span class="n">client</span> <span class="n">postgresql</span><span class="o">-</span><span class="mf">9.5</span> <span class="n">mongodb</span><span class="o">-</span><span class="n">server</span>
</pre></div>
</div>
<p>Create the postgres db:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">su</span> <span class="n">postgres</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;echo </span><span class="se">\&quot;</span><span class="s2">CREATE ROLE contractor WITH PASSWORD &#39;contractor&#39; NOSUPERUSER NOCREATEDB NOCREATEROLE LOGIN;</span><span class="se">\&quot;</span><span class="s2"> | psql&quot;</span>
<span class="n">sudo</span> <span class="n">su</span> <span class="n">postgres</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;createdb -O contractor contractor&quot;</span>
</pre></div>
</div>
<p>NOTE, for those two commands you may see something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">could</span> <span class="ow">not</span> <span class="n">change</span> <span class="n">directory</span> <span class="n">to</span> <span class="s2">&quot;/root&quot;</span><span class="p">:</span> <span class="n">Permission</span> <span class="n">denied</span>
</pre></div>
</div>
<p>this is from the <cite>su</cite> command, thoes messages can be ignored</p>
</div>
<div class="section" id="update-packages">
<h2>Update Packages<a class="headerlink" href="#update-packages" title="Permalink to this headline">¶</a></h2>
<p>The Ubuntu toml and jinja2 packages are too old, update with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">python3</span><span class="o">-</span><span class="n">pip</span>
<span class="n">sudo</span> <span class="n">pip3</span> <span class="n">install</span> <span class="n">toml</span> <span class="n">jinja2</span> <span class="o">--</span><span class="n">upgrade</span>
</pre></div>
</div>
<p>if you are using the Virtualbox plugin, you will need zeep:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">pip3</span> <span class="n">install</span> <span class="n">zeep</span>
</pre></div>
</div>
<p>for VCenter/ESX install pyvmomi:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">pip3</span> <span class="n">install</span> <span class="n">pyvmomi</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-apache">
<h2>Configure Apache<a class="headerlink" href="#configure-apache" title="Permalink to this headline">¶</a></h2>
<p>We will need a HTTP site to serve up static resources, as well as a Proxy server
to bridge from the isolated network.  This proxy server will also cache. We are
using Apache to Proxy with for this example, however you can use any proxy you
would like, just update the <cite>proxy-server</cite> paramater to the <cite>setupWizard</cite> call.</p>
<p>First create the directory for the static resources:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">static</span>
</pre></div>
</div>
<p>now create the proxy site <cite>/etc/apache2/sites-available/proxy.conf</cite> with the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Listen 3128
&lt;VirtualHost *:3128&gt;
  ServerName proxy
  ServerAlias proxy.site1.test

  DocumentRoot /var/www/static

  ErrorLog ${APACHE_LOG_DIR}/proxy_error.log
  CustomLog ${APACHE_LOG_DIR}/proxy_access.log combined

  ProxyRequests On
  ProxyVia Full

  CacheEnable disk http://
  CacheEnable disk https://

  NoProxy static static.site1.test
  NoProxy contractor contractor.site1.test

  # ProxyRemote * http://&lt;up stream proxy&gt;:3128/
&lt;/VirtualHost&gt;
</pre></div>
</div>
<p>NOTE: if you need to relay through an upstream proxy to have access to the ubuntu
and centos mirrors, enable the <cite>ProxyRemote</cite> line and update it with the upstream proxy.
Now create the static site <cite>/etc/apache2/sites-available/static.conf</cite> with the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;VirtualHost *:80&gt;
  ServerName static
  ServerAlias static.site1.test

  DocumentRoot /var/www/static

  LogFormat &quot;%a %t %D \&quot;%r\&quot; %&gt;s %I %O \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %X&quot; static_log
  ErrorLog ${APACHE_LOG_DIR}/static_error.log
  CustomLog ${APACHE_LOG_DIR}/static_access.log static_log
&lt;/VirtualHost&gt;
</pre></div>
</div>
<p>Modify <cite>/etc/apache2/sites-available/contractor.conf</cite> and enable the ServerAlias
line, and change the <cite>&lt;domain&gt;</cite> to <cite>site1.test</cite></p>
<p>Now enable the proxy and static site, disable the default site, and reload the
apache configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">a2ensite</span> <span class="n">proxy</span>
<span class="n">sudo</span> <span class="n">a2ensite</span> <span class="n">static</span>
<span class="n">sudo</span> <span class="n">a2dissite</span> <span class="mi">000</span><span class="o">-</span><span class="n">default</span>
<span class="n">sudo</span> <span class="n">a2enmod</span> <span class="n">proxy</span> <span class="n">proxy_connect</span> <span class="n">proxy_ftp</span> <span class="n">proxy_http</span> <span class="n">cache_disk</span> <span class="n">cache</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">apache2</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">apache</span><span class="o">-</span><span class="n">htcacheclean</span>
</pre></div>
</div>
</div>
<div class="section" id="setup-the-database">
<h2>Setup the database<a class="headerlink" href="#setup-the-database" title="Permalink to this headline">¶</a></h2>
<p>Now to create the db:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">contractor</span><span class="o">/</span><span class="n">util</span><span class="o">/</span><span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span>
</pre></div>
</div>
<p>Install the iputils functions, this contains the port check function contractor
will use to verify the OS has booted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">respkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">contractor</span><span class="o">-</span><span class="n">plugins</span><span class="o">-</span><span class="n">iputils_</span><span class="o">*.</span><span class="n">respkg</span>
</pre></div>
</div>
<p>Install base os config:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">respkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">contractor</span><span class="o">-</span><span class="n">os</span><span class="o">-</span><span class="n">base_</span><span class="o">*.</span><span class="n">respkg</span>
</pre></div>
</div>
<p>Now to enable plugins.
We use manual for misc stuff that is either pre-configured or handled by something else:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">respkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">contractor</span><span class="o">-</span><span class="n">plugins</span><span class="o">-</span><span class="n">manual_</span><span class="o">*.</span><span class="n">respkg</span>
</pre></div>
</div>
<p>if you are using ESX/VCenter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">respkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">contractor</span><span class="o">-</span><span class="n">plugins</span><span class="o">-</span><span class="n">vcenter_</span><span class="o">*.</span><span class="n">respkg</span>
</pre></div>
</div>
<p>if you are using Virtualbox:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">respkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">contractor</span><span class="o">-</span><span class="n">plugins</span><span class="o">-</span><span class="n">virtualbox_</span><span class="o">*.</span><span class="n">respkg</span>
</pre></div>
</div>
<p>if you are using IPMI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">respkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">contractor</span><span class="o">-</span><span class="n">plugins</span><span class="o">-</span><span class="n">ipmi_</span><span class="o">*.</span><span class="n">respkg</span>
</pre></div>
</div>
<p>if you are using AMT:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">respkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">contractor</span><span class="o">-</span><span class="n">plugins</span><span class="o">-</span><span class="n">amt_</span><span class="o">*.</span><span class="n">respkg</span>
</pre></div>
</div>
<p>do manual plugin again so it can cross link to the other plugins:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">respkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">contractor</span><span class="o">-</span><span class="n">plugins</span><span class="o">-</span><span class="n">manual_</span><span class="o">*.</span><span class="n">respkg</span>
</pre></div>
</div>
<p>restart apache so it loads the newly enabled plutings:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">apache2</span>
</pre></div>
</div>
<p>Now to configure the base contractor information, this includes configuring bind.
This command will prompt you for the password to use for the <cite>root</cite> user that we
will be using for API calls.  Set <cite>&lt; interface name &gt;</cite> to the name of the interface
on the internal network:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">contractor</span><span class="o">/</span><span class="n">setup</span><span class="o">/</span><span class="n">setupWizard</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">ip</span><span class="o">-</span><span class="n">reservation</span> <span class="o">--</span><span class="n">dns</span><span class="o">-</span><span class="n">server</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.10</span> <span class="o">--</span><span class="n">proxy</span><span class="o">-</span><span class="n">server</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.10</span><span class="p">:</span><span class="mi">3128</span><span class="o">/</span> <span class="o">--</span><span class="n">primary</span><span class="o">-</span><span class="n">interface</span><span class="o">=&lt;</span> <span class="n">interface</span> <span class="n">name</span> <span class="o">&gt;</span>
</pre></div>
</div>
<p>It is safe to ignore the message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rndc</span><span class="p">:</span> <span class="n">connect</span> <span class="n">failed</span><span class="p">:</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="c1">#953: connection refused</span>
<span class="n">WARNING</span><span class="p">:</span> <span class="s2">&quot;rndc reload&quot;</span> <span class="n">failed</span>
</pre></div>
</div>
<p>Bind (the DNS server) is not running yet, it will be started later.</p>
</div>
<div class="section" id="environment-setup">
<h2>Environment Setup<a class="headerlink" href="#environment-setup" title="Permalink to this headline">¶</a></h2>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; height: auto;">
    <iframe src="https://www.youtube.com/embed/TIEt0UWRrpk" frameborder="0" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe>
</div><p>We will be using the HTTP API to inject new stuff into contractor.
You can run these commands from either the contractor VM, or any place that can make
http requests to contractor.</p>
<p>we will be using curl, make sure it is installed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">curl</span>
</pre></div>
</div>
<p>First we will define some Environment values so we don’t have to keep tying redundant info
the Contractor server.  This is assuming you will be running these commands from
the contractor VM, if you are running these steps from someplace else, update the
ip address to the ip address of the contractor vm:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">COPS</span><span class="o">=</span><span class="p">(</span> <span class="o">--</span><span class="n">noproxy</span> \<span class="o">*</span> <span class="o">--</span><span class="n">header</span> <span class="s2">&quot;CInP-Version: 0.9&quot;</span> <span class="o">--</span><span class="n">header</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="p">)</span>
<span class="n">export</span> <span class="n">SITE</span><span class="o">=</span><span class="s2">&quot;/api/v1/Site/Site:site1:&quot;</span>
<span class="n">export</span> <span class="n">CHOST</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1&quot;</span>
</pre></div>
</div>
<p>COPS is defining some curl options. SITE defines the uri of the site we are going
to use, and CHOST is the URL to the Contractor server.</p>
<p>now we need to login, replace the <cite>&lt; password &gt;</cite> with the password you passed to
<cite>setupWizard</cite> (the <cite>–root-password</cite> paramater):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>echo &#39;{ &quot;username&quot;: &quot;root&quot;, &quot;password&quot;: &quot;&lt; password &gt;&quot; }&#39; | curl &quot;${COPS[@]}&quot; --data @- -X CALL $CHOST/api/v1/Auth/User\(login\)
</pre></div>
</div>
<p>which will output something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;k4of9zewijvze0gf72ylb6p6zxv4srol&quot;</span>
</pre></div>
</div>
<p>which will return a auth token, save that to our headers, replace <cite>&lt; username &gt;</cite>
with the API username, and <cite>&lt; auth token &gt;</cite> with the result of the last command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">COPS</span><span class="o">+=</span><span class="p">(</span> <span class="o">--</span><span class="n">header</span> <span class="s2">&quot;Auth-Id: root&quot;</span><span class="p">)</span>
<span class="n">COPS</span><span class="o">+=</span><span class="p">(</span> <span class="o">--</span><span class="n">header</span> <span class="s2">&quot;Auth-Token: &lt; auth token &gt;&quot;</span> <span class="p">)</span>
</pre></div>
</div>
<p>This is adding more headers to our curl options, from here on our curl operations
are authenticated.  Let’s make sure our login is working:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>echo &#39;{}&#39; | curl &quot;${COPS[@]}&quot; --data @- -X CALL $CHOST/api/v1/Auth/User\(whoami\)
</pre></div>
</div>
<p>that should output your username, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;root&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="http-requests-note">
<h2>HTTP Requests Note<a class="headerlink" href="#http-requests-note" title="Permalink to this headline">¶</a></h2>
<p>As you may of noticed from the Authentication requests, each request has some JSON
encoded request data, as well as a JSON encoded response.  Contractor uses a REST like
HTTP-JSON library called CInP, which can be found at <a class="reference external" href="https://github.com/cinp/">https://github.com/cinp/</a>.
CInP is the reason for the <cite>CInP-Version: 0.9</cite> HTTP Header.  Going forward most
requests are going to use the heredoc method for passing the request body to
curl.  If you are not familure with this method, keep in mind that for requests
the require modification (ie: the have &lt;something&gt; in them), don’t copy paste
everything at once, generally it works to copy paste everything but the last <cite>EOF</cite>
then back arrow, fix what ever values you need to fix, go to the end, hit &lt;enter&gt;
then type in the closing <cite>EOF</cite>.  The requests that don’t need modification, you can
copy paste all at once.</p>
<p>Some requests create objects, when <cite>-X CREATE</cite> is used with curl, the id of the
created object is found in the header <cite>Object-Id</cite>, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">201</span> <span class="n">CREATED</span>
<span class="n">Date</span><span class="p">:</span> <span class="n">Thu</span><span class="p">,</span> <span class="mi">23</span> <span class="n">May</span> <span class="mi">2019</span> <span class="mi">23</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">17</span> <span class="n">GMT</span>
<span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">18</span> <span class="p">(</span><span class="n">Ubuntu</span><span class="p">)</span>
<span class="n">Verb</span><span class="p">:</span> <span class="n">CREATE</span>
<span class="n">Access</span><span class="o">-</span><span class="n">Control</span><span class="o">-</span><span class="n">Allow</span><span class="o">-</span><span class="n">Origin</span><span class="p">:</span> <span class="o">*</span>
<span class="n">Cinp</span><span class="o">-</span><span class="n">Version</span><span class="p">:</span> <span class="mf">0.9</span>
<span class="n">Access</span><span class="o">-</span><span class="n">Control</span><span class="o">-</span><span class="n">Expose</span><span class="o">-</span><span class="n">Headers</span><span class="p">:</span> <span class="n">Method</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Cinp</span><span class="o">-</span><span class="n">Version</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="n">Position</span><span class="p">,</span> <span class="n">Total</span><span class="p">,</span> <span class="n">Multi</span><span class="o">-</span><span class="n">Object</span><span class="p">,</span> <span class="n">Object</span><span class="o">-</span><span class="n">Id</span><span class="p">,</span> <span class="n">Id</span><span class="o">-</span><span class="n">Only</span>
<span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<span class="n">Object</span><span class="o">-</span><span class="n">Id</span><span class="p">:</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">Utilities</span><span class="o">/</span><span class="n">AddressBlock</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">318</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span><span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>

<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;internal&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;254&quot;</span><span class="p">,</span> <span class="s2">&quot;_max_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.255&quot;</span><span class="p">,</span> <span class="s2">&quot;gateway_offset&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-05-23T23:42:17.180084+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Site/Site:site1:&quot;</span><span class="p">,</span> <span class="s2">&quot;netmask&quot;</span><span class="p">:</span> <span class="s2">&quot;255.255.255.0&quot;</span><span class="p">,</span> <span class="s2">&quot;subnet&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-05-23T23:42:17.180121+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;gateway&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;isIpV4&quot;</span><span class="p">:</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">}</span>
</pre></div>
</div>
<p>The url of that newly created AddressBlock is <cite>/api/v1/Utilities/AddressBlock:2:</cite>,
generally we are only concerned with the id which is between the <cite>:</cite> in this case
the id is <cite>2</cite>.  We will point out when you need to take note of id of a created object.</p>
<p>For the most part when we display the output of a request, we are not going to show
the headers, just the response body.</p>
</div>
<div class="section" id="network-configuration">
<h2>Network Configuration<a class="headerlink" href="#network-configuration" title="Permalink to this headline">¶</a></h2>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; height: auto;">
    <iframe src="https://www.youtube.com/embed/hdY97j2u4rc" frameborder="0" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe>
</div><p>The setupWizard has pre-loaded the database with a stand in host to represent
the contractor VM and has flagged it as pre-built.  It has also created
a site called <cite>site1</cite> and some base DNS configuration. It also took the network
of the primary interface and loaded it into the database as the Network <cite>main</cite>,
and AddressBlock name <cite>main</cite>.</p>
<p>First we need to set an Environment variable for the existing AddressBlock:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">ADRBLK</span><span class="o">=</span><span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>
</pre></div>
</div>
<p>Now to create network for the internal network.  Contractor will use the name of the Network
to know what virtual network to select when deploying VMs.  Replace <cite>&lt; network name &gt;</cite> with
the name of the network created in vcenter (ie: internal) or virtual box (ie: vboxnet0):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cat &lt;&lt; EOF | curl -i &quot;${COPS[@]}&quot; --data @- -X CREATE $CHOST/api/v1/Utilities/Network
{ &quot;site&quot;: &quot;$SITE&quot;, &quot;name&quot;: &quot;&lt; network name &gt;&quot; }
EOF
</pre></div>
</div>
<p>result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vboxnet0&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block_list&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Site/Site:site1:&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-10-24T17:55:09.024672+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-10-24T17:55:09.024647+00:00&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Take note of the id of that created AddressBlock.  Set another environment variable
to the Id value, replace the <cite>&lt; id &gt;</cite> to the id of the above id:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">NETWORK</span><span class="o">=</span><span class="s2">&quot;/api/v1/Utilities/Network:&lt; id &gt;:&quot;</span>
</pre></div>
</div>
<p>Now to attach the AddressBlock to the Network:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cat &lt;&lt; EOF | curl -i &quot;${COPS[@]}&quot; --data @- -X CREATE $CHOST/api/v1/Utilities/NetworkAddressBlock
{ &quot;network&quot;: &quot;$NETWORK&quot;, &quot;address_block&quot;: &quot;$ADRBLK&quot; }
EOF
</pre></div>
</div>
<p>result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/Network:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;vlan&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;vlan_tagged&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-10-24T17:58:54.146006+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-10-24T17:58:54.146044+00:00&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>now to reserve some ip addresses so they do not get auto assigned:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for OFFSET in 2 3 4 5 6 7 8 9 11 12 13 14 15 16 17 18 19 20; do
cat &lt;&lt; EOF | curl &quot;${COPS[@]}&quot; --data @- -X CREATE $CHOST/api/v1/Utilities/ReservedAddress
{ &quot;address_block&quot;: &quot;$ADRBLK&quot;, &quot;offset&quot;: &quot;$OFFSET&quot;, &quot;reason&quot;: &quot;Network Reserved&quot; }
EOF
done
</pre></div>
</div>
<p>result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.2&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.312992+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.312941+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.3&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.327090+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.327065+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.4&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.339957+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.339924+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.5&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.352559+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.352535+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.6&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.365187+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.365162+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.7&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.378354+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.378327+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.8&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.390835+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.390812+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.9&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.404003+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.403980+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.11&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.416552+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.416528+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.12&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.429354+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.429332+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.13&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.442067+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.442043+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.14&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.455041+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.455018+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.15&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.467245+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.467222+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.16&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.479525+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.479503+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.17&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.492109+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.492083+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.18&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.504386+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.504363+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.19&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.517128+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.517105+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.20&quot;</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Network Reserved&quot;</span><span class="p">,</span> <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.529458+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;address_block&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-23T16:34:54.529435+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ReservedAddress&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="starting-dns">
<h2>Starting DNS<a class="headerlink" href="#starting-dns" title="Permalink to this headline">¶</a></h2>
<p>Restart bind with new zones:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">bind9</span>
</pre></div>
</div>
<p>Now to force a re-gen of the DNS files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">contractor</span><span class="o">/</span><span class="n">cron</span><span class="o">/</span><span class="n">genDNS</span>
</pre></div>
</div>
<p>This VM needs to use the contractor generated dns, so edit
<cite>/etc/network/interfaces</cite> to set the dns server to “127.0.0.1”, and set the dns
search to “site1.test site1”. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auto</span> <span class="n">ensXXX</span>
<span class="n">iface</span> <span class="n">ensXXX</span> <span class="n">inet</span> <span class="n">static</span>
  <span class="o">...</span>
  <span class="n">dns</span><span class="o">-</span><span class="n">nameservers</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>
  <span class="n">dns</span><span class="o">-</span><span class="n">search</span> <span class="n">site1</span><span class="o">.</span><span class="n">test</span> <span class="n">test</span>
</pre></div>
</div>
<p>then reload networking configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">networking</span>
</pre></div>
</div>
<p>now if you ping contractor you should get the internal ip (10.0.0.10):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ping</span> <span class="n">static</span> <span class="o">-</span><span class="n">c2</span>
</pre></div>
</div>
<p>result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PING</span> <span class="n">eth1</span><span class="o">.</span><span class="n">contractor</span><span class="o">.</span><span class="n">site1</span><span class="o">.</span><span class="n">test</span> <span class="p">(</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.10</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="nn">contractor.site1.test</span> <span class="p">(</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.10</span><span class="p">):</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.031</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="nn">contractor.site1.test</span> <span class="p">(</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.10</span><span class="p">):</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">2</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.063</span> <span class="n">ms</span>
</pre></div>
</div>
<p>now take a look at the contractor ui at <a class="reference external" href="http:/">http:/</a>/&lt;contractor ip&gt;, (this ip is the ip
you assigned to the first interface)</p>
</div>
<div class="section" id="subcontractor">
<h2>Subcontractor<a class="headerlink" href="#subcontractor" title="Permalink to this headline">¶</a></h2>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; height: auto;">
    <iframe src="https://www.youtube.com/embed/O_fCrUK3mvs" frameborder="0" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe>
</div><p>install tfptd (used for PXE booting) and the PXE booting agent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">tftpd</span><span class="o">-</span><span class="n">hpa</span>
<span class="n">sudo</span> <span class="n">respkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">contractor</span><span class="o">-</span><span class="n">ipxe_</span><span class="o">*.</span><span class="n">respkg</span>
</pre></div>
</div>
<p>now edit <cite>/etc/subcontractor.conf</cite>
enable the modules you want to use, remove the ‘;’ and set the 0 to a 1.
The 1 means one task for that plugin at a time.  If you want to be able to process
more targets at the same time, you can try 2 or 4 depending on the plugin, the
resources of your vm, etc.  You may also want to change the <cite>poll_interval</cite> to 5, this
will cause subcontractor to ask for more tasks every 5 seconds instead of the default
20.  If we were setting up a system that would be processing a lot of tasks, we would
want to slow this down to reduce the overhead on contractor. In the dhcpd section,
make sure <cite>listen_interface</cite> and <cite>tftp_server</cite> are correct, <cite>tftp_server</cite> should be the ip of
the vm on the new internal interface.</p>
<p>now start up subcontractor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">subcontractor</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">dhcpd</span>
</pre></div>
</div>
<p>make sure it’s running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">status</span> <span class="n">subcontractor</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">status</span> <span class="n">dhcpd</span>
</pre></div>
</div>
<p>optional, edit <cite>/etc/default/tftpd-hpa</cite> and add ‘-v ‘ to TFTP_OPTIONS.  This will
cause tfptd to log transfers to syslog.  This can be helpful in troubleshooting
boot problems. Make sure to run <cite>systemctl restart tftpd-hpa</cite> to reload.</p>
</div>
<div class="section" id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>If you are installing to VCenter or VirtualBox:
<a class="reference internal" href="complex.html"><span class="doc">Setting up VM Host</span></a></p>
<p>If you are installing on a BareMetal/IPMI machine:
<a class="reference internal" href="install_baremetal.html"><span class="doc">Install ESX</span></a></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">t3kton</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Contractor</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Introduction.html">Introduction to Contractor</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Give it a Try</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ConfigurationValues.html">Configuration Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Networking.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Modules.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tscript.html">tscript</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Plugins.html#todo">TODO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Resources.html">Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API.html">CInP API Documentation for Contractor API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#future">Future</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Contractor</a><ul>
  <li><a href="index.html">Give it a Try</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Give it a Try</a></li>
      <li>Next: <a href="packaged.html" title="next chapter">From Prebuilt Packages</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Peter Howe.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>