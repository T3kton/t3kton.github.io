

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Installing &#8212; t3kton 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="From Prebuilt Packages" href="packaged.html" />
    <link rel="prev" title="Give it a Try" href="index.html" />

    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-159896960-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-159896960-1');
</script>

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="packaged.html" title="From Prebuilt Packages"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Give it a Try"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">t3kton 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Contractor</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Give it a Try</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installing</a><ul>
<li><a class="reference internal" href="#from-source">From Source</a></li>
<li><a class="reference internal" href="#from-packages">From Packages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setup">Setup</a><ul>
<li><a class="reference internal" href="#set-up-infrastructure">Set up Infrastructure</a></li>
<li><a class="reference internal" href="#create-database">Create Database</a></li>
<li><a class="reference internal" href="#configure-apache">Configure Apache</a></li>
<li><a class="reference internal" href="#setup-the-database">Setup the Database</a></li>
<li><a class="reference internal" href="#environment-setup">Environment Setup</a></li>
<li><a class="reference internal" href="#http-requests-note">HTTP Requests Note</a></li>
<li><a class="reference internal" href="#network-configuration">Network Configuration</a></li>
<li><a class="reference internal" href="#starting-dns">Starting DNS</a></li>
<li><a class="reference internal" href="#subcontractor">Subcontractor</a></li>
<li><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Give it a Try</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="packaged.html"
                        title="next chapter">From Prebuilt Packages</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="installing">
<h1>Installing<a class="headerlink" href="#installing" title="Permalink to this headline">¶</a></h1>
<p>Create an Ubuntu Xenial(16.04LTS) VM, name it <cite>contractor</cite>, set the fqdn to <cite>contractor.site1.test</cite>
Ideally it should be in a /24 network.  Offset 1 is assumed to be the gateway.
All these values can be adjusted either in the setupWizard file before it is run,
or after it is setup, you can use the API to edit these values.
The DNS server will be set for the contractor VM, and bind on the contractor vm will
be set to forward to the DNS server that was originally configured on the VM.</p>
<div class="section" id="from-source">
<h2>From Source<a class="headerlink" href="#from-source" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="source.html"><span class="doc">From Source</span></a></p>
</div>
<div class="section" id="from-packages">
<h2>From Packages<a class="headerlink" href="#from-packages" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="packaged.html"><span class="doc">From Prebuilt Packages</span></a></p>
</div>
</div>
<div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<p>we will be using curl, make sure it is installed:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo apt install -y curl
</pre></div>
</div>
<div class="section" id="set-up-infrastructure">
<h2>Set up Infrastructure<a class="headerlink" href="#set-up-infrastructure" title="Permalink to this headline">¶</a></h2>
<p>To prevent your new contractor VM from taking over the network you are curently
connected to, you will need to configure a issloated network.  There are also
some other Infrastructure related tasks that need to be done.</p>
<p><a class="reference internal" href="setup_vcenter.html"><span class="doc">VCenter/ESX Setup</span></a></p>
<p><a class="reference internal" href="setup_virtualbox.html"><span class="doc">VirtualBox Setup</span></a></p>
<p><a class="reference internal" href="setup_ipmi.html"><span class="doc">IPMI Setup</span></a></p>
<p><a class="reference internal" href="setup_amt.html"><span class="doc">AMT Setup</span></a></p>
<p><a class="reference internal" href="setup_docker.html"><span class="doc">Docker Setup</span></a></p>
<p>the ubuntu toml package is to old, update with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo apt install -y python3-pip
sudo pip3 install toml --upgrade
</pre></div>
</div>
</div>
<div class="section" id="create-database">
<h2>Create Database<a class="headerlink" href="#create-database" title="Permalink to this headline">¶</a></h2>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; height: auto;">
    <iframe src="https://www.youtube.com/embed/Wjm6kKus1Ho" frameborder="0" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe>
</div><p>Install Postgres:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo apt install -y postgresql-client postgresql-10 mongodb-server
</pre></div>
</div>
<p>Create the postgres db:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo su postgres -c <span class="s2">&quot;echo \&quot;CREATE ROLE contractor WITH PASSWORD &#39;contractor&#39; NOSUPERUSER NOCREATEDB NOCREATEROLE LOGIN;\&quot; | psql&quot;</span>
sudo su postgres -c <span class="s2">&quot;createdb -O contractor contractor&quot;</span>
</pre></div>
</div>
<p>NOTE, for those two commands you may see something like:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>could not change directory to <span class="s2">&quot;/root&quot;</span>: Permission denied
</pre></div>
</div>
<p>this is from the <cite>su</cite> command, thoes messages can be ignored</p>
</div>
<div class="section" id="configure-apache">
<h2>Configure Apache<a class="headerlink" href="#configure-apache" title="Permalink to this headline">¶</a></h2>
<p>We will need a HTTP site to serve up static resources, as well as a Proxy server
to bridge from the isolated network.  This proxy server will also cache. We are
using Apache to Proxy with for this example, however you can use any proxy you
would like, just update the <cite>proxy-server</cite> parameter to the <cite>setupWizard</cite> call.</p>
<p>There is a script that will the apache setup.  Download and make it executable:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>curl https://t3kton.github.io/_static/apache_setup.sh
chmod +x apache_setup.sh
</pre></div>
</div>
<p>If you do NOT have an upstream proxy:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo ./apache_setup.sh
</pre></div>
</div>
<p>If you do have an upstream proxy:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">UPSTREAM_PROXY</span><span class="o">=</span>&lt;upstream proxy, ie: http://myproxy:3128/&gt; sudo ./apache_setup.sh
</pre></div>
</div>
</div>
<div class="section" id="setup-the-database">
<h2>Setup the Database<a class="headerlink" href="#setup-the-database" title="Permalink to this headline">¶</a></h2>
<p>Now to create the db:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>/usr/lib/contractor/util/manage.py migrate
</pre></div>
</div>
<p>Install the iputils functions, this contains the port check function contractor
will use to verify the OS has booted:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo respkg -i contractor-plugins-iputils_*.respkg
</pre></div>
</div>
<p>Install base os config:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo respkg -i contractor-os-base_*.respkg
</pre></div>
</div>
<p>If you are going to use IPMI or AMT, Install the disks package, this has the bootstrap,
set-rtc, and disk-wipe PXE images:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo respkg -i disks-contractor_*.respkg
</pre></div>
</div>
<p>Now to enable plugins.
We use manual for misc stuff that is either pre-configured or handled by something else:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo respkg -i contractor-plugins-manual_*.respkg
</pre></div>
</div>
<p>if you are using ESX/VCenter:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo respkg -i contractor-plugins-vcenter_*.respkg
</pre></div>
</div>
<p>if you are using Virtualbox:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo respkg -i contractor-plugins-virtualbox_*.respkg
</pre></div>
</div>
<p>if you are using IPMI:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo respkg -i contractor-plugins-ipmi_*.respkg
</pre></div>
</div>
<p>if you are using AMT:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo respkg -i contractor-plugins-amt_*.respkg
</pre></div>
</div>
<p>if you are using Docker:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo respkg -i contractor-plugins-docker_*.respkg
</pre></div>
</div>
<p>restart apache so it loads the newly enabled plutings:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo systemctl restart apache2
</pre></div>
</div>
<p>Now to configure the base contractor information, this includes configuring bind.
This command will prompt you for the password to use for the <cite>root</cite> user that we
will be using for API calls.  Set <cite>&lt; interface name &gt;</cite> to the name of the interface
on the internal network:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo /usr/lib/contractor/setup/setupWizard --no-ip-reservation --dns-server<span class="o">=</span><span class="m">10</span>.0.0.10 --proxy-server<span class="o">=</span>http://10.0.0.10:3128/ --ntp-server<span class="o">=</span>contractor --primary-interface<span class="o">=</span>&lt; interface name &gt;
</pre></div>
</div>
<p>It is safe to ignore the message:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>rndc: connect failed: <span class="m">127</span>.0.0.1#953: connection refused
WARNING: <span class="s2">&quot;rndc reload&quot;</span> failed
</pre></div>
</div>
<p>Bind (the DNS server) is not running yet, it will be started later.</p>
</div>
<div class="section" id="environment-setup">
<h2>Environment Setup<a class="headerlink" href="#environment-setup" title="Permalink to this headline">¶</a></h2>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; height: auto;">
    <iframe src="https://www.youtube.com/embed/TIEt0UWRrpk" frameborder="0" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe>
</div><p>We will be using the HTTP API to inject new stuff into contractor.
You can run these commands from either the contractor VM, or any place that can make
http requests to contractor.</p>
<p>First we will define some Environment values so we don’t have to keep tying redundant info
the Contractor server.  This is assuming you will be running these commands from
the contractor VM, if you are running these steps from someplace else, update the
ip address to the ip address of the contractor vm:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">COPS</span><span class="o">=(</span> --noproxy <span class="se">\*</span> --header <span class="s2">&quot;CInP-Version: 0.9&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">)</span>
<span class="nb">export</span> <span class="nv">SITE</span><span class="o">=</span><span class="s2">&quot;/api/v1/Site/Site:site1:&quot;</span>
<span class="nb">export</span> <span class="nv">CHOST</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1&quot;</span>
</pre></div>
</div>
<p>COPS is defining some curl options. SITE defines the uri of the site we are going
to use, and CHOST is the URL to the Contractor server.</p>
<p>now we need to login, replace the <cite>&lt; password &gt;</cite> with the password you passed to
<cite>setupWizard</cite> (the <cite>–root-password</cite> paramater):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">&#39;{ &quot;username&quot;: &quot;root&quot;, &quot;password&quot;: &quot;&lt; password &gt;&quot; }&#39;</span> <span class="p">|</span> curl <span class="s2">&quot;</span><span class="si">${</span><span class="nv">COPS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span> --data @- -X CALL <span class="nv">$CHOST</span>/api/v1/Auth/User<span class="se">\(</span>login<span class="se">\)</span>
</pre></div>
</div>
<p>which will output something like:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="s2">&quot;k4of9zewijvze0gf72ylb6p6zxv4srol&quot;</span>
</pre></div>
</div>
<p>which will return a auth token, save that to our headers, replace <cite>&lt; username &gt;</cite>
with the API username, and <cite>&lt; auth token &gt;</cite> with the result of the last command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">COPS</span><span class="o">+=(</span> --header <span class="s2">&quot;Auth-Id: root&quot;</span><span class="o">)</span>
<span class="nv">COPS</span><span class="o">+=(</span> --header <span class="s2">&quot;Auth-Token: &lt; auth token &gt;&quot;</span> <span class="o">)</span>
</pre></div>
</div>
<p>This is adding more headers to our curl options, from here on our curl operations
are authenticated.  Let’s make sure our login is working:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">&#39;{}&#39;</span> <span class="p">|</span> curl <span class="s2">&quot;</span><span class="si">${</span><span class="nv">COPS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span> --data @- -X CALL <span class="nv">$CHOST</span>/api/v1/Auth/User<span class="se">\(</span>whoami<span class="se">\)</span>
</pre></div>
</div>
<p>that should output your username, for example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="s2">&quot;root&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="http-requests-note">
<h2>HTTP Requests Note<a class="headerlink" href="#http-requests-note" title="Permalink to this headline">¶</a></h2>
<p>As you may of noticed from the Authentication requests, each request has some JSON
encoded request data, as well as a JSON encoded response.  Contractor uses a REST like
HTTP-JSON library called CInP, which can be found at <a class="reference external" href="https://github.com/cinp/">https://github.com/cinp/</a>.
CInP is the reason for the <cite>CInP-Version: 0.9</cite> HTTP Header.  Going forward most
requests are going to use the heredoc method for passing the request body to
curl.  If you are not familure with this method, keep in mind that for requests
the require modification (ie: the have &lt;something&gt; in them), don’t copy paste
everything at once, generally it works to copy paste everything but the last <cite>EOF</cite>
then back arrow, fix what ever values you need to fix, go to the end, hit &lt;enter&gt;
then type in the closing <cite>EOF</cite>.  The requests that don’t need modification, you can
copy paste all at once.</p>
<p>Some requests create objects, when <cite>-X CREATE</cite> is used with curl, the id of the
created object is found in the header <cite>Object-Id</cite>, for example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>HTTP/1.1 <span class="m">201</span> CREATED
Date: Thu, <span class="m">23</span> May <span class="m">2019</span> <span class="m">23</span>:42:17 GMT
Server: Apache/2.4.18 <span class="o">(</span>Ubuntu<span class="o">)</span>
Verb: CREATE
Access-Control-Allow-Origin: *
Cinp-Version: <span class="m">0</span>.9
Access-Control-Expose-Headers: Method, Type, Cinp-Version, Count, Position, Total, Multi-Object, Object-Id, Id-Only
Cache-Control: no-cache
Object-Id: /api/v1/Utilities/AddressBlock:2:
Content-Length: <span class="m">318</span>
Content-Type: application/json<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>utf-8

<span class="o">{</span><span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;internal&quot;</span>, <span class="s2">&quot;size&quot;</span>: <span class="s2">&quot;254&quot;</span>, <span class="s2">&quot;_max_address&quot;</span>: <span class="s2">&quot;10.0.0.255&quot;</span>, <span class="s2">&quot;gateway_offset&quot;</span>: null, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-05-23T23:42:17.180084+00:00&quot;</span>, <span class="s2">&quot;site&quot;</span>: <span class="s2">&quot;/api/v1/Site/Site:site1:&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-05-23T23:42:17.180121+00:00&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null, <span class="s2">&quot;isIpV4&quot;</span>: <span class="s2">&quot;True&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="m">24</span><span class="o">}</span>
</pre></div>
</div>
<p>The url of that newly created AddressBlock is <cite>/api/v1/Utilities/AddressBlock:2:</cite>,
generally we are only concerned with the id which is between the <cite>:</cite> in this case
the id is <cite>2</cite>.  We will point out when you need to take note of id of a created object.</p>
<p>For the most part when we display the output of a request, we are not going to show
the headers, just the response body.</p>
</div>
<div class="section" id="network-configuration">
<h2>Network Configuration<a class="headerlink" href="#network-configuration" title="Permalink to this headline">¶</a></h2>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; height: auto;">
    <iframe src="https://www.youtube.com/embed/hdY97j2u4rc" frameborder="0" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe>
</div><p>The setupWizard has pre-loaded the database with a stand in host to represent
the contractor VM and has flagged it as pre-built.  It has also created
a site called <cite>site1</cite> and some base DNS configuration. It also took the network
of the primary interface and loaded it into the database as the Network <cite>main</cite>,
and AddressBlock name <cite>main</cite>.</p>
<p>First we need to set an Environment variable for the existing AddressBlock:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ADRBLK</span><span class="o">=</span><span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>
</pre></div>
</div>
<p>Now to create network for the internal network.  Contractor will use the name of the Network
to know what virtual network to select when deploying VMs.  Replace <cite>&lt; network name &gt;</cite> with
the name of the network created in vcenter (ie: internal) or virtual box (ie: vboxnet0), for
IPMI and AMT, use ‘internal’:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cat <span class="s">&lt;&lt; EOF | curl -i &quot;${COPS[@]}&quot; --data @- -X CREATE $CHOST/api/v1/Utilities/Network</span>
<span class="s">{ &quot;site&quot;: &quot;$SITE&quot;, &quot;name&quot;: &quot;&lt; network name &gt;&quot; }</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p>result:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">{</span><span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;vboxnet0&quot;</span>, <span class="s2">&quot;address_block_list&quot;</span>: <span class="o">[]</span>, <span class="s2">&quot;site&quot;</span>: <span class="s2">&quot;/api/v1/Site/Site:site1:&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-10-24T17:55:09.024672+00:00&quot;</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-10-24T17:55:09.024647+00:00&quot;</span><span class="o">}</span>
</pre></div>
</div>
<p>Take note of the id of that created AddressBlock.  Set another environment variable
to the Id value, replace the <cite>&lt; id &gt;</cite> to the id of the above id:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">NETWORK</span><span class="o">=</span><span class="s2">&quot;/api/v1/Utilities/Network:&lt; id &gt;:&quot;</span>
</pre></div>
</div>
<p>Now to attach the AddressBlock to the Network:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cat <span class="s">&lt;&lt; EOF | curl -i &quot;${COPS[@]}&quot; --data @- -X CREATE $CHOST/api/v1/Utilities/NetworkAddressBlock</span>
<span class="s">{ &quot;network&quot;: &quot;$NETWORK&quot;, &quot;address_block&quot;: &quot;$ADRBLK&quot; }</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p>result:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">{</span><span class="s2">&quot;network&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/Network:2:&quot;</span>, <span class="s2">&quot;vlan&quot;</span>: <span class="m">0</span>, <span class="s2">&quot;vlan_tagged&quot;</span>: false, <span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:2:&quot;</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-10-24T17:58:54.146006+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-10-24T17:58:54.146044+00:00&quot;</span><span class="o">}</span>
</pre></div>
</div>
<p>now to reserve some ip addresses so they do not get auto assigned:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="k">for</span> OFFSET in <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">8</span> <span class="m">9</span> <span class="m">11</span> <span class="m">12</span> <span class="m">13</span> <span class="m">14</span> <span class="m">15</span> <span class="m">16</span> <span class="m">17</span> <span class="m">18</span> <span class="m">19</span> <span class="m">20</span><span class="p">;</span> <span class="k">do</span>
cat <span class="s">&lt;&lt; EOF | curl &quot;${COPS[@]}&quot; --data @- -X CREATE $CHOST/api/v1/Utilities/ReservedAddress</span>
<span class="s">{ &quot;address_block&quot;: &quot;$ADRBLK&quot;, &quot;offset&quot;: &quot;$OFFSET&quot;, &quot;reason&quot;: &quot;Network Reserved&quot; }</span>
<span class="s">EOF</span>
<span class="k">done</span>
</pre></div>
</div>
<p>result:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">2</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.350596+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.350625+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.2&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">3</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.384282+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.384306+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.3&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">4</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.420326+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.420348+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.4&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">5</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.445826+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.445852+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.5&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">6</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.471761+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.471781+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.6&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">7</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.496654+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.496676+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.7&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">8</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.524865+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.524899+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.8&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">9</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.552813+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.552836+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.9&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">11</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.579828+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.579867+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.11&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">12</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.607718+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.607740+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.12&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">13</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.636675+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.636697+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.13&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">14</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.662100+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.662127+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.14&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">15</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.688283+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.688311+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.15&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">16</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.715900+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.715922+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.16&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">17</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.745761+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.745797+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.17&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">18</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.772841+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.772863+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.18&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">19</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.800554+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.800588+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.19&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">20</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.827612+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:26.827637+00:00&quot;</span>, <span class="s2">&quot;reason&quot;</span>: <span class="s2">&quot;Network Reserved&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;ReservedAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.20&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
</pre></div>
</div>
<p>If you are installing to AMT/IPMI you will need some dynamic Ips for devices we
do not yet have MAC addresses for, we are going to set these to PXE boot to the
bootstrap image, if you are not going to to AMT/IPMI, skip this step, you probably
do not have the bootstrap PXE image loaded:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="k">for</span> OFFSET in <span class="m">21</span> <span class="m">22</span> <span class="m">23</span> <span class="m">24</span> <span class="m">25</span><span class="p">;</span> <span class="k">do</span>
cat <span class="s">&lt;&lt; EOF | curl &quot;${COPS[@]}&quot; --data @- -X CREATE $CHOST/api/v1/Utilities/DynamicAddress</span>
<span class="s">{ &quot;address_block&quot;: &quot;$ADRBLK&quot;, &quot;offset&quot;: &quot;$OFFSET&quot;, &quot;pxe&quot;: &quot;/api/v1/BluePrint/PXE:bootstrap:&quot; }</span>
<span class="s">EOF</span>
<span class="k">done</span>
</pre></div>
</div>
<p>result:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">21</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:45.380257+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:45.380307+00:00&quot;</span>, <span class="s2">&quot;pxe&quot;</span>: <span class="s2">&quot;/api/v1/BluePrint/PXE:bootstrap:&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;DynamicAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.21&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">22</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:45.415840+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:45.415876+00:00&quot;</span>, <span class="s2">&quot;pxe&quot;</span>: <span class="s2">&quot;/api/v1/BluePrint/PXE:bootstrap:&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;DynamicAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.22&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">23</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:45.448887+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:45.448930+00:00&quot;</span>, <span class="s2">&quot;pxe&quot;</span>: <span class="s2">&quot;/api/v1/BluePrint/PXE:bootstrap:&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;DynamicAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.23&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">24</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:45.475547+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:45.475569+00:00&quot;</span>, <span class="s2">&quot;pxe&quot;</span>: <span class="s2">&quot;/api/v1/BluePrint/PXE:bootstrap:&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;DynamicAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.24&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
<span class="o">{</span><span class="s2">&quot;address_block&quot;</span>: <span class="s2">&quot;/api/v1/Utilities/AddressBlock:1:&quot;</span>, <span class="s2">&quot;offset&quot;</span>: <span class="m">25</span>, <span class="s2">&quot;updated&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:45.501742+00:00&quot;</span>, <span class="s2">&quot;created&quot;</span>: <span class="s2">&quot;2019-11-05T02:58:45.501762+00:00&quot;</span>, <span class="s2">&quot;pxe&quot;</span>: <span class="s2">&quot;/api/v1/BluePrint/PXE:bootstrap:&quot;</span>, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;DynamicAddress&quot;</span>, <span class="s2">&quot;ip_address&quot;</span>: <span class="s2">&quot;10.0.0.25&quot;</span>, <span class="s2">&quot;subnet&quot;</span>: <span class="s2">&quot;10.0.0.0&quot;</span>, <span class="s2">&quot;netmask&quot;</span>: <span class="s2">&quot;255.255.255.0&quot;</span>, <span class="s2">&quot;prefix&quot;</span>: <span class="s2">&quot;24&quot;</span>, <span class="s2">&quot;gateway&quot;</span>: null<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="starting-dns">
<h2>Starting DNS<a class="headerlink" href="#starting-dns" title="Permalink to this headline">¶</a></h2>
<p>Restart bind with new zones:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo systemctl restart bind9
</pre></div>
</div>
<p>Now to force a re-gen of the DNS files:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo /usr/lib/contractor/cron/genDNS
</pre></div>
</div>
<p>This VM needs to use the contractor generated dns, so edit the file in /etc/netplan/
to set the dns server to “127.0.0.1”, and set the dns search to “site1.test site1”.
For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>network:
  ...
  enp0s3:
    ...
    nameservers:
      search: <span class="o">[</span>site1.test test<span class="o">]</span>
      addresses: <span class="o">[</span><span class="m">127</span>.0.0.1<span class="o">]</span>
</pre></div>
</div>
<p>then apply the networking configuration:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo netplan apply
</pre></div>
</div>
<p>now let’s see if the network and bind settings are working properly:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>host static
</pre></div>
</div>
<p>results:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>static.site1.test is an <span class="nb">alias</span> <span class="k">for</span> contractor.site1.test.
contractor.site1.test has address &lt;contractor ip&gt;
contractor.site1.test is an <span class="nb">alias</span> <span class="k">for</span> enp0s8.contractor.site1.test.
</pre></div>
</div>
<p>The “search” value from netplan file is used to convert “static” to
“static.site1.test”.  The first line resolving the alias is from the bind file
that contractor just generated. The second line is systemd-resolved reading your
/etc/hosts file to resolve contractor.site1.test. The third line is from bind as
well.</p>
<p>NOTE: if you were to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>dig @127.0.0.1 +short static.site1.test
</pre></div>
</div>
<p>you would get:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>contractor.site1.test.
enp0s8.contractor.site1.test.
<span class="m">10</span>.0.0.10
</pre></div>
</div>
<p>which results in a different ip address, this is the result from external hosts
resolving against bind.  In this case systemd-resolved is not consulted, and the
value in your /etc/hosts file is not used.  If you would like the same result
externally and internally, you can either cut systemd-resolvd out of the loop internally
or edit your /etc/hosts file and change the ip address(&lt;contractor ip&gt;) to the ip
of the internal interface(10.0.0.10).</p>
<p>now take a look at the contractor ui at <a class="reference external" href="http:/">http:/</a>/&lt;contractor ip&gt;, (this ip is the ip
you assigned to the first interface)</p>
</div>
<div class="section" id="subcontractor">
<h2>Subcontractor<a class="headerlink" href="#subcontractor" title="Permalink to this headline">¶</a></h2>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; height: auto;">
    <iframe src="https://www.youtube.com/embed/O_fCrUK3mvs" frameborder="0" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe>
</div><p>install tfptd (used for PXE booting) and the PXE booting agent:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo apt install -y tftpd-hpa
sudo respkg -i contractor-ipxe_*.respkg
</pre></div>
</div>
<p>now edit <cite>/etc/subcontractor.conf</cite>
enable the modules you want to use, remove the ‘;’ and set the 0 to a 1.
The 1 means one task for that plugin at a time.  If you want to be able to process
more targets at the same time, you can try 2 or 4 depending on the plugin, the
resources of your vm, etc.  You may also want to change the <cite>poll_interval</cite> to 5, this
will cause subcontractor to ask for more tasks every 5 seconds instead of the default
20.  If we were setting up a system that would be processing a lot of tasks, we would
want to slow this down to reduce the overhead on contractor. In the dhcpd section,
make sure <cite>listen_interface</cite> and <cite>tftp_server</cite> are correct, <cite>tftp_server</cite> should be the ip of
the vm on the new internal interface.</p>
<p>now start up subcontractor:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo systemctl start subcontractor
sudo systemctl start dhcpd
</pre></div>
</div>
<p>make sure they are running:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo systemctl status subcontractor
sudo systemctl status dhcpd
</pre></div>
</div>
<p>optional, edit <cite>/etc/default/tftpd-hpa</cite> and add ‘-v ‘ to TFTP_OPTIONS.  This will
cause tfptd to log transfers to syslog.  This can be helpful in troubleshooting
boot problems. Make sure to run <cite>systemctl restart tftpd-hpa</cite> to reload.</p>
</div>
<div class="section" id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>If you are installing to VCenter or VirtualBox:
<a class="reference internal" href="complex.html"><span class="doc">Setting up VM Host</span></a></p>
<p>If you are installing on a BareMetal/IPMI machine:
<a class="reference internal" href="install_baremetal.html"><span class="doc">Setup Bare-metal</span></a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="packaged.html" title="From Prebuilt Packages"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Give it a Try"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">t3kton 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Contractor</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Give it a Try</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Peter Howe.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.
    </div>
  </body>
</html>