
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Accessing Configuration Information &#8212; t3kton 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="accessing-configuration-information">
<h1>Accessing Configuration Information<a class="headerlink" href="#accessing-configuration-information" title="Permalink to this headline">¶</a></h1>
<p>Contractor provides three configuration urls for a target.  The first two depend on
what the target is set to PXE boot to, the third is all the configuration information
for that target in JSON format.</p>
<p>ssh into one of the VMs, this will show what it is like from testvm02:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">root</span><span class="nd">@testvm02</span>
</pre></div>
</div>
<p>First the pxe script, this script is downloaded and run but the iPXE boot loader
that the target VM was told to download from the dhcp server.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">contractor</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">boot_script</span><span class="o">/</span>
</pre></div>
</div>
<p>which will output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!ipxe</span>

<span class="n">echo</span> <span class="n">Booting</span> <span class="n">form</span> <span class="n">Primary</span> <span class="n">Boot</span> <span class="n">Disk</span>
<span class="n">sanboot</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">describe</span> <span class="o">--</span><span class="n">drive</span> <span class="mh">0x80</span> <span class="o">||</span> <span class="n">echo</span> <span class="n">Primary</span> <span class="n">Boot</span> <span class="n">Disk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Bootable</span>
</pre></div>
</div>
<p>The VM is current set to the <cite>normal-boot</cite> pxe.  That script tells it to boot to the
first harddrive.</p>
<p>Next the pxe_template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">contractor</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">pxe_template</span><span class="o">/</span>
</pre></div>
</div>
<p>output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normal Boot</span>
</pre></div>
</div>
<p>once again, with this VM having been set to <cite>normal-boot</cite>, the pxe template is
just a comment at the top.  The pxe_template is stored as a Jinja2 template that
is combined with the configuration information and served out to the target.
This is the URL that is used for the Kickstart and/or Pressed files for the CentOS
and Debian installers.  The source for the CentOS and Ubuntu boot_scripts and
pxe_templates are at <a class="reference external" href="https://github.com/T3kton/resources/blob/master/os-bases/centos/usr/lib/contractor/resources/centos.toml">https://github.com/T3kton/resources/blob/master/os-bases/centos/usr/lib/contractor/resources/centos.toml</a>
and <a class="reference external" href="https://github.com/T3kton/resources/blob/master/os-bases/ubuntu/usr/lib/contractor/resources/ubuntu.toml">https://github.com/T3kton/resources/blob/master/os-bases/ubuntu/usr/lib/contractor/resources/ubuntu.toml</a>
those are then packaged during when you built the resources, and installed to
/usr/lib/contractor/resource/ when the resource package was installed.</p>
<p>The third url is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">contractor</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">config</span><span class="o">/</span>
</pre></div>
</div>
<p>output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;installer_pxe&quot;</span><span class="p">:</span> <span class="s2">&quot;centos-7&quot;</span><span class="p">,</span> <span class="s2">&quot;__pxe_template_location&quot;</span><span class="p">:</span> <span class="s2">&quot;http://contractor/config/pxe_template/&quot;</span><span class="p">,</span> <span class="s2">&quot;_structure_config_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;118e0e44-457e-47df-b8c0-d157d5dde1b4&quot;</span><span class="p">,</span> <span class="s2">&quot;mirror_server&quot;</span><span class="p">:</span> <span class="s2">&quot;mirror.centos.org&quot;</span><span class="p">,</span> <span class="s2">&quot;_blueprint&quot;</span><span class="p">:</span> <span class="s2">&quot;centos-7-base&quot;</span><span class="p">,</span> <span class="s2">&quot;__timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-03-11T14:32:27.909856+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;_foundation_state&quot;</span><span class="p">:</span> <span class="s2">&quot;built&quot;</span><span class="p">,</span> <span class="s2">&quot;domain_name&quot;</span><span class="p">:</span> <span class="s2">&quot;site1.test&quot;</span><span class="p">,</span> <span class="s2">&quot;dns_search&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;site1.test&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span> <span class="s2">&quot;_structure_state&quot;</span><span class="p">:</span> <span class="s2">&quot;built&quot;</span><span class="p">,</span> <span class="s2">&quot;__pxe_location&quot;</span><span class="p">:</span> <span class="s2">&quot;http://static/pxe/&quot;</span><span class="p">,</span> <span class="s2">&quot;distro&quot;</span><span class="p">:</span> <span class="s2">&quot;centos&quot;</span><span class="p">,</span> <span class="s2">&quot;_hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;testvm02&quot;</span><span class="p">,</span> <span class="s2">&quot;_foundation_class_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;VM&quot;</span><span class="p">,</span> <span class="s2">&quot;VCenter&quot;</span><span class="p">],</span> <span class="s2">&quot;dns_servers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;10.0.0.10&quot;</span><span class="p">],</span> <span class="s2">&quot;memory_size&quot;</span><span class="p">:</span> <span class="mi">2048</span><span class="p">,</span> <span class="s2">&quot;_foundation_type&quot;</span><span class="p">:</span> <span class="s2">&quot;VCenter&quot;</span><span class="p">,</span> <span class="s2">&quot;_provisioning_interface&quot;</span><span class="p">:</span> <span class="s2">&quot;eth0&quot;</span><span class="p">,</span> <span class="s2">&quot;_vcenter_complex&quot;</span><span class="p">:</span> <span class="s2">&quot;demovcenter&quot;</span><span class="p">,</span> <span class="s2">&quot;_interface_map&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;eth0&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;physical_location&quot;</span><span class="p">:</span> <span class="s2">&quot;eth0&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;eth0&quot;</span><span class="p">,</span> <span class="s2">&quot;mac&quot;</span><span class="p">:</span> <span class="s2">&quot;00:50:56:03:1e:6d&quot;</span><span class="p">,</span> <span class="s2">&quot;address_list&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;vlan&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.123&quot;</span><span class="p">,</span> <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s2">&quot;netmask&quot;</span><span class="p">:</span> <span class="s2">&quot;255.255.255.0&quot;</span><span class="p">,</span> <span class="s2">&quot;primary&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;sub_interface&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;tagged&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;gateway&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;mtu&quot;</span><span class="p">:</span> <span class="mi">1500</span><span class="p">}]}},</span> <span class="s2">&quot;_foundation_locator&quot;</span><span class="p">:</span> <span class="s2">&quot;testvm02&quot;</span><span class="p">,</span> <span class="s2">&quot;_vcenter_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;52545577-0025-e8d7-1915-bd64585f47c1&quot;</span><span class="p">,</span> <span class="s2">&quot;_vcenter_cluster&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost.&quot;</span><span class="p">,</span> <span class="s2">&quot;_site&quot;</span><span class="p">:</span> <span class="s2">&quot;site1&quot;</span><span class="p">,</span> <span class="s2">&quot;ntp_servers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ntp.ubuntu.com&quot;</span><span class="p">],</span> <span class="s2">&quot;distro_version&quot;</span><span class="p">:</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;_fqdn&quot;</span><span class="p">:</span> <span class="s2">&quot;testvm02.site1.test&quot;</span><span class="p">,</span> <span class="s2">&quot;mirror_proxy&quot;</span><span class="p">:</span> <span class="s2">&quot;http://10.0.0.10:3128/&quot;</span><span class="p">,</span> <span class="s2">&quot;_foundation_interface_list&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;physical_location&quot;</span><span class="p">:</span> <span class="s2">&quot;eth0&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;eth0&quot;</span><span class="p">,</span> <span class="s2">&quot;mac&quot;</span><span class="p">:</span> <span class="s2">&quot;00:50:56:03:1e:6d&quot;</span><span class="p">,</span> <span class="s2">&quot;address_list&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;vlan&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.123&quot;</span><span class="p">,</span> <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s2">&quot;netmask&quot;</span><span class="p">:</span> <span class="s2">&quot;255.255.255.0&quot;</span><span class="p">,</span> <span class="s2">&quot;primary&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;sub_interface&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;tagged&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;gateway&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;mtu&quot;</span><span class="p">:</span> <span class="mi">1500</span><span class="p">}]}],</span> <span class="s2">&quot;__contractor_host&quot;</span><span class="p">:</span> <span class="s2">&quot;http://contractor/&quot;</span><span class="p">,</span> <span class="s2">&quot;_foundation_id&quot;</span><span class="p">:</span> <span class="s2">&quot;testvm02&quot;</span><span class="p">,</span> <span class="s2">&quot;vcenter_guest_id&quot;</span><span class="p">:</span> <span class="s2">&quot;rhel7_64Guest&quot;</span><span class="p">,</span> <span class="s2">&quot;swap_size&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> <span class="s2">&quot;_structure_id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;__last_modified&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-03-11T14:01:18.090983+00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;_provisioning_interface_mac&quot;</span><span class="p">:</span> <span class="s2">&quot;00:50:56:03:1e:6d&quot;</span><span class="p">,</span> <span class="s2">&quot;_vcenter_datacenter&quot;</span><span class="p">:</span> <span class="s2">&quot;ha-datacenter&quot;</span><span class="p">,</span> <span class="s2">&quot;virtualbox_guest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;RedHat_64&quot;</span><span class="p">,</span> <span class="s2">&quot;root_pass&quot;</span><span class="p">:</span> <span class="s2">&quot;$6$rootroot$oLo.loyMV45VA7/0sKV5JH/xBAXiq/igL4hQrGz3yd9XUavmC82tZm1lxW2N.5eLxQUlqp53wXKRzifZApP0/1&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>This url can be used by what ever scripts/CMS as a source of configuration
information.  See the documentation at <a class="reference internal" href="ConfigurationValues.html"><span class="doc">Configuration Values</span></a> for more
information on how these values are compiled.  One value to point out here is
<cite>_structure_config_uuid</cite>, this value is set when the structure record is created
or when the structure is destroyed.  This way if there is a stale copy of the
structure (old VM snapshot, or a VM that didn’t get cleaned up properly, etc)
comes on-line, it (or some other monitoring system) can detect that it is no
longer current and take action.</p>
<p>Contractor uses the source ip address of this URL requests to determine which
target’s information to return.  You can also use the structure id, foundation
locater or config uuid, to tell contractor which configuration to return.</p>
<p>by config uuid:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">contractor</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="mf">118e0</span><span class="n">e44</span><span class="o">-</span><span class="mf">457e-47</span><span class="n">df</span><span class="o">-</span><span class="n">b8c0</span><span class="o">-</span><span class="n">d157d5dde1b4</span>
</pre></div>
</div>
<p>by structure id:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">contractor</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">s</span><span class="o">/</span><span class="mi">4</span>
</pre></div>
</div>
<p>by foundation locator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">contractor</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">f</span><span class="o">/</span><span class="n">testvm02</span>
</pre></div>
</div>
<p>one way for a target to detect if it is slit good and in cases when the ip address
might change, is to request it’s config by the uuid.</p>
</div>
<div class="section" id="next-steps">
<h1>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="TryIt_destroy_vm.html"><span class="doc">Removing the VM(s)</span></a></p>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">t3kton</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Contractor</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#id1">Contractor</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Peter Howe.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>